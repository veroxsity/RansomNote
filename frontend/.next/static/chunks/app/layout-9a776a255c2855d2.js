(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[185],{7198:function(e,o,n){Promise.resolve().then(n.bind(n,3798)),Promise.resolve().then(n.bind(n,4616)),Promise.resolve().then(n.t.bind(n,2801,23))},2852:function(e,o,n){"use strict";n.d(o,{G:function(){return t}});var r=n(2265);let t=(0,r.createContext)(null)},3798:function(e,o,n){"use strict";n.r(o),n.d(o,{GameProvider:function(){return GameProvider}});var r=n(7437),t=n(2265),i=n(2852),l=n(5358),u=n(5925);let GameProvider=e=>{let{children:o}=e,{socket:n,isConnected:d}=(0,l.s)(),[s,c]=(0,t.useState)({lobby:null,currentPlayer:null,round:null,error:null,isLoading:!1,hasSubmitted:!1,hasVoted:!1,lastWinnerId:null,isJudgeTurn:!1});(0,t.useEffect)(()=>{if(!n)return;let onLobbyUpdate=e=>{c(o=>{var n,r;return{...o,lobby:e,round:null!==(n=e.currentRound)&&void 0!==n?n:o.round,currentPlayer:o.currentPlayer&&null!==(r=e.players.find(e=>e.id===o.currentPlayer.id))&&void 0!==r?r:o.currentPlayer,isLoading:!1}})},onLobbyJoined=e=>{c(o=>({...o,lobby:e.lobby,currentPlayer:e.player,isLoading:!1}));try{window.__ransom_lobby_code__=e.lobby.code}catch(e){}},onRoundBegin=e=>{c(o=>({...o,currentPlayer:o.currentPlayer?{...o.currentPlayer,words:e.words}:o.currentPlayer,round:{prompt:e.prompt,submissions:{},votes:{},stage:"ANSWERING",submissionTime:e.timeLimit},hasSubmitted:!1,hasVoted:!1}))},onRoundReveal=e=>{c(o=>({...o,round:o.round?{...o.round,submissions:e.submissions,stage:"REVEALING"}:o.round}))},onJudgeBegin=e=>{c(o=>({...o,isJudgeTurn:!0,round:o.round?{...o.round,submissions:e.submissions,stage:"VOTING"}:o.round}))},onLobbyError=e=>{c(o=>({...o,error:e.message,isLoading:!1}));try{u.ZP.error(e.message)}catch(e){}},onSubmitAck=e=>{if(c(o=>{var n;return{...o,hasSubmitted:!!e.ok,error:e.ok?o.error:null!==(n=e.message)&&void 0!==n?n:"Submit failed"}}),e.ok)try{u.ZP.success("Answer submitted")}catch(e){}else try{var o;u.ZP.error(null!==(o=e.message)&&void 0!==o?o:"Submit failed")}catch(e){}},onVoteAck=e=>{if(c(o=>{var n;return{...o,hasVoted:!!e.ok,error:e.ok?o.error:null!==(n=e.message)&&void 0!==n?n:"Vote failed"}}),e.ok)try{u.ZP.success("Vote submitted")}catch(e){}else try{var o;u.ZP.error(null!==(o=e.message)&&void 0!==o?o:"Vote failed")}catch(e){}},onWinner=e=>{if(c(o=>{var n;return{...o,lastWinnerId:null!==(n=null==e?void 0:e.winnerId)&&void 0!==n?n:null,isJudgeTurn:!1}}),(null==e?void 0:e.winnerId)==null)try{(0,u.ZP)("Round complete")}catch(e){}else try{var o,n,r;let t=null!==(r=null===(n=s.lobby)||void 0===n?void 0:null===(o=n.players.find(o=>o.id===e.winnerId))||void 0===o?void 0:o.nickname)&&void 0!==r?r:"Winner";u.ZP.success("".concat(t," wins the round"))}catch(e){}};return n.on("lobby:update",onLobbyUpdate),n.on("lobby:joined",onLobbyJoined),n.on("round:begin",onRoundBegin),n.on("round:reveal",onRoundReveal),n.on("judge:begin",onJudgeBegin),n.on("lobby:error",onLobbyError),n.on("round:submitAck",onSubmitAck),n.on("round:voteAck",onVoteAck),n.on("result:winner",onWinner),()=>{n.off("lobby:update",onLobbyUpdate),n.off("lobby:joined",onLobbyJoined),n.off("round:begin",onRoundBegin),n.off("round:reveal",onRoundReveal),n.off("judge:begin",onJudgeBegin),n.off("lobby:error",onLobbyError),n.off("round:submitAck",onSubmitAck),n.off("round:voteAck",onVoteAck),n.off("result:winner",onWinner)}},[n]);let a=(0,t.useCallback)(e=>{n&&(c(e=>({...e,isLoading:!0,error:null})),n.emit("lobby:create",{nickname:e}))},[n]),b=(0,t.useCallback)((e,o)=>{n&&(c(e=>({...e,isLoading:!0,error:null})),n.emit("lobby:join",{code:e,nickname:o}))},[n]),y=(0,t.useCallback)(()=>{n&&s.lobby&&n.emit("game:start",{code:s.lobby.code})},[n,s.lobby]),v=(0,t.useCallback)(()=>{n&&s.lobby&&(c(e=>({...e,isLoading:!0})),n.emit("player:ready",{code:s.lobby.code}))},[n,s.lobby]),m=(0,t.useCallback)(e=>{n&&s.lobby&&s.currentPlayer&&!s.hasSubmitted&&n.emit("round:submit",{lobbyCode:s.lobby.code,playerId:s.currentPlayer.id,answer:e})},[n,s.lobby,s.currentPlayer,s.hasSubmitted]),f=(0,t.useCallback)(e=>{n&&s.lobby&&s.currentPlayer&&!s.hasVoted&&n.emit("round:vote",{lobbyCode:s.lobby.code,voterId:s.currentPlayer.id,submissionId:e})},[n,s.lobby,s.currentPlayer,s.hasVoted]),g=(0,t.useCallback)(e=>{n&&s.lobby&&n.emit("judge:pick",{lobbyCode:s.lobby.code,winnerId:e})},[n,s.lobby]);return(0,r.jsxs)(i.G.Provider,{value:{...s,isConnected:d,createLobby:a,joinLobby:b,startGame:y,setReady:v,submitAnswer:m,submitVote:f,judgePick:g},children:[(0,r.jsx)(u.x7,{position:"top-right"}),o]})}},5358:function(e,o,n){"use strict";n.d(o,{J:function(){return t},s:function(){return useSocket}});var r=n(2265);let t=(0,r.createContext)({socket:null,isConnected:!1}),useSocket=()=>(0,r.useContext)(t)},4616:function(e,o,n){"use strict";n.r(o),n.d(o,{SocketProvider:function(){return SocketProvider}});var r=n(7437),t=n(2265),i=n(4337),l=n(5358),u=n(2601);let d=u.env.NEXT_PUBLIC_SOCKET_URL||"",s=u.env.NEXT_PUBLIC_BACKEND_PORT||"",SocketProvider=e=>{let{children:o}=e,[n,c]=(0,t.useState)(null),[a,b]=(0,t.useState)(!1);return(0,t.useEffect)(()=>{var e;let o=d;if(!o||"auto"===o){let e=window.location.protocol,n=window.location.hostname,r=s||"3001";o="".concat(e,"//").concat(n,":").concat(r)}let n=(0,i.io)(o,{path:"/socket.io",transports:["websocket"],withCredentials:!0,autoConnect:!0,reconnection:!0,reconnectionAttempts:1/0,reconnectionDelay:1e3,reconnectionDelayMax:5e3}),r=(null!==(e=u.env.NEXT_PUBLIC_DEBUG_SOCKET)&&void 0!==e?e:"false")==="true"||"true"===window.localStorage.getItem("debugSocket");r&&n.onAny(function(e){for(var o,n=arguments.length,r=Array(n>1?n-1:0),t=1;t<n;t++)r[t-1]=arguments[t];"ping"!==e&&"pong"!==e&&console.log("\uD83D\uDCE9 socket event:",e,null!==(o=null==r?void 0:r[0])&&void 0!==o?o:"")}),n.on("connect",()=>{console.log("Connected to Socket.IO server"),b(!0)}),n.on("disconnect",()=>{console.log("Disconnected from Socket.IO server"),b(!1)}),c(n);let endListener=()=>{if(n&&n.connected){let e=window.__ransom_lobby_code__;e&&n.emit("game:end",{code:e})}};return window.addEventListener("game:end-request",endListener),()=>{n.close(),window.removeEventListener("game:end-request",endListener)}},[]),(0,r.jsx)(l.J.Provider,{value:{socket:n,isConnected:a},children:o})}},2801:function(){}},function(e){e.O(0,[214,971,472,744],function(){return e(e.s=7198)}),_N_E=e.O()}]);